"""Integration tests for organization control"""
from .regex_dict import RegExDict
from click.testing import CliRunner
from dothub._main import dothub
import copy
import yaml
import tempfile
import sealedmock
from mock import Mock


base_args = ["--user=xxx", "--token=yyy"]


GET_REQUESTS = RegExDict({
    ".*/orgs/etcaterva$": {'public_gists': 0, 'url': 'https://api.github.com/orgs/etcaterva', 'location': '', 'plan': {'seats': 0, 'private_repos': 0, 'space': 976562499, 'name': 'free', 'filled_seats': 3}, 'login': 'etcaterva', 'hooks_url': 'https://api.github.com/orgs/etcaterva/hooks', 'public_members_url': 'https://api.github.com/orgs/etcaterva/public_members{/member}', 'collaborators': 0, 'description': 'Group of friends that code :)', 'issues_url': 'https://api.github.com/orgs/etcaterva/issues', 'members_url': 'https://api.github.com/orgs/etcaterva/members{/member}', 'following': 0, 'html_url': 'https://github.com/etcaterva', 'billing_email': 'mariocj89@gmail.com', 'repos_url': 'https://api.github.com/orgs/etcaterva/repos', 'created_at': '2015-03-03T20:12:29Z', 'id': 11301498, 'total_private_repos': 0, 'updated_at': '2016-05-14T09:21:28Z', 'name': 'EtCaterva', 'email': '', 'private_gists': 0, 'events_url': 'https://api.github.com/orgs/etcaterva/events', 'followers': 0, 'type': 'Organization', 'company': None, 'disk_usage': 17304, 'public_repos': 5, 'blog': 'http://etcaterva.com', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'owned_private_repos': 0},
    ".*/orgs/etcaterva/members$": [{'events_url': 'https://api.github.com/users/dnaranjo89/events{/privacy}', 'following_url': 'https://api.github.com/users/dnaranjo89/following{/other_user}', 'url': 'https://api.github.com/users/dnaranjo89', 'starred_url': 'https://api.github.com/users/dnaranjo89/starred{/owner}{/repo}', 'id': 9324508, 'login': 'dnaranjo89', 'repos_url': 'https://api.github.com/users/dnaranjo89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/9324508?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/dnaranjo89/subscriptions', 'received_events_url': 'https://api.github.com/users/dnaranjo89/received_events', 'gists_url': 'https://api.github.com/users/dnaranjo89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/dnaranjo89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/dnaranjo89/followers', 'html_url': 'https://github.com/dnaranjo89'}, {'events_url': 'https://api.github.com/users/Mariocj89/events{/privacy}', 'following_url': 'https://api.github.com/users/Mariocj89/following{/other_user}', 'url': 'https://api.github.com/users/Mariocj89', 'starred_url': 'https://api.github.com/users/Mariocj89/starred{/owner}{/repo}', 'id': 3709683, 'login': 'Mariocj89', 'repos_url': 'https://api.github.com/users/Mariocj89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/3709683?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/Mariocj89/subscriptions', 'received_events_url': 'https://api.github.com/users/Mariocj89/received_events', 'gists_url': 'https://api.github.com/users/Mariocj89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/Mariocj89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/Mariocj89/followers', 'html_url': 'https://github.com/Mariocj89'}, {'events_url': 'https://api.github.com/users/palvarez89/events{/privacy}', 'following_url': 'https://api.github.com/users/palvarez89/following{/other_user}', 'url': 'https://api.github.com/users/palvarez89', 'starred_url': 'https://api.github.com/users/palvarez89/starred{/owner}{/repo}', 'id': 1928801, 'login': 'palvarez89', 'repos_url': 'https://api.github.com/users/palvarez89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/1928801?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/palvarez89/subscriptions', 'received_events_url': 'https://api.github.com/users/palvarez89/received_events', 'gists_url': 'https://api.github.com/users/palvarez89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/palvarez89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/palvarez89/followers', 'html_url': 'https://github.com/palvarez89'}],
    ".*/orgs/etcaterva/memberships/dnaranjo89$": {'role': 'admin', 'organization': {'events_url': 'https://api.github.com/orgs/etcaterva/events', 'url': 'https://api.github.com/orgs/etcaterva', 'members_url': 'https://api.github.com/orgs/etcaterva/members{/member}', 'public_members_url': 'https://api.github.com/orgs/etcaterva/public_members{/member}', 'repos_url': 'https://api.github.com/orgs/etcaterva/repos', 'issues_url': 'https://api.github.com/orgs/etcaterva/issues', 'login': 'etcaterva', 'id': 11301498, 'hooks_url': 'https://api.github.com/orgs/etcaterva/hooks', 'description': 'Group of friends that code :)', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3'}, 'url': 'https://api.github.com/orgs/etcaterva/memberships/dnaranjo89', 'organization_url': 'https://api.github.com/orgs/etcaterva', 'state': 'active', 'user': {'events_url': 'https://api.github.com/users/dnaranjo89/events{/privacy}', 'following_url': 'https://api.github.com/users/dnaranjo89/following{/other_user}', 'url': 'https://api.github.com/users/dnaranjo89', 'starred_url': 'https://api.github.com/users/dnaranjo89/starred{/owner}{/repo}', 'id': 9324508, 'login': 'dnaranjo89', 'repos_url': 'https://api.github.com/users/dnaranjo89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/9324508?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/dnaranjo89/subscriptions', 'received_events_url': 'https://api.github.com/users/dnaranjo89/received_events', 'gists_url': 'https://api.github.com/users/dnaranjo89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/dnaranjo89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/dnaranjo89/followers', 'html_url': 'https://github.com/dnaranjo89'}},
    ".*/orgs/etcaterva/memberships/Mariocj89$": {'role': 'admin', 'organization': {'events_url': 'https://api.github.com/orgs/etcaterva/events', 'url': 'https://api.github.com/orgs/etcaterva', 'members_url': 'https://api.github.com/orgs/etcaterva/members{/member}', 'public_members_url': 'https://api.github.com/orgs/etcaterva/public_members{/member}', 'repos_url': 'https://api.github.com/orgs/etcaterva/repos', 'issues_url': 'https://api.github.com/orgs/etcaterva/issues', 'login': 'etcaterva', 'id': 11301498, 'hooks_url': 'https://api.github.com/orgs/etcaterva/hooks', 'description': 'Group of friends that code :)', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3'}, 'url': 'https://api.github.com/orgs/etcaterva/memberships/Mariocj89', 'organization_url': 'https://api.github.com/orgs/etcaterva', 'state': 'active', 'user': {'events_url': 'https://api.github.com/users/Mariocj89/events{/privacy}', 'following_url': 'https://api.github.com/users/Mariocj89/following{/other_user}', 'url': 'https://api.github.com/users/Mariocj89', 'starred_url': 'https://api.github.com/users/Mariocj89/starred{/owner}{/repo}', 'id': 3709683, 'login': 'Mariocj89', 'repos_url': 'https://api.github.com/users/Mariocj89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/3709683?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/Mariocj89/subscriptions', 'received_events_url': 'https://api.github.com/users/Mariocj89/received_events', 'gists_url': 'https://api.github.com/users/Mariocj89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/Mariocj89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/Mariocj89/followers', 'html_url': 'https://github.com/Mariocj89'}},
    ".*/orgs/etcaterva/memberships/palvarez89$": {'role': 'admin', 'organization': {'events_url': 'https://api.github.com/orgs/etcaterva/events', 'url': 'https://api.github.com/orgs/etcaterva', 'members_url': 'https://api.github.com/orgs/etcaterva/members{/member}', 'public_members_url': 'https://api.github.com/orgs/etcaterva/public_members{/member}', 'repos_url': 'https://api.github.com/orgs/etcaterva/repos', 'issues_url': 'https://api.github.com/orgs/etcaterva/issues', 'login': 'etcaterva', 'id': 11301498, 'hooks_url': 'https://api.github.com/orgs/etcaterva/hooks', 'description': 'Group of friends that code :)', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3'}, 'url': 'https://api.github.com/orgs/etcaterva/memberships/palvarez89', 'organization_url': 'https://api.github.com/orgs/etcaterva', 'state': 'active', 'user': {'events_url': 'https://api.github.com/users/palvarez89/events{/privacy}', 'following_url': 'https://api.github.com/users/palvarez89/following{/other_user}', 'url': 'https://api.github.com/users/palvarez89', 'starred_url': 'https://api.github.com/users/palvarez89/starred{/owner}{/repo}', 'id': 1928801, 'login': 'palvarez89', 'repos_url': 'https://api.github.com/users/palvarez89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/1928801?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/palvarez89/subscriptions', 'received_events_url': 'https://api.github.com/users/palvarez89/received_events', 'gists_url': 'https://api.github.com/users/palvarez89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/palvarez89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/palvarez89/followers', 'html_url': 'https://github.com/palvarez89'}},
    ".*/orgs/etcaterva/teams$": [{'slug': 'automation', 'url': 'https://api.github.com/teams/1338338', 'members_url': 'https://api.github.com/teams/1338338/members{/member}', 'id': 1338338, 'repositories_url': 'https://api.github.com/teams/1338338/repos', 'description': '', 'permission': 'admin', 'name': 'Automation', 'privacy': 'closed'}, {'slug': 'mobile', 'url': 'https://api.github.com/teams/1827619', 'members_url': 'https://api.github.com/teams/1827619/members{/member}', 'id': 1827619, 'repositories_url': 'https://api.github.com/teams/1827619/repos', 'description': 'Pepole working in the apps', 'permission': 'pull', 'name': 'Mobile', 'privacy': 'closed'}, {'slug': 'web', 'url': 'https://api.github.com/teams/1827620', 'members_url': 'https://api.github.com/teams/1827620/members{/member}', 'id': 1827620, 'repositories_url': 'https://api.github.com/teams/1827620/repos', 'description': 'Web developers', 'permission': 'pull', 'name': 'Web', 'privacy': 'closed'}],
    ".*/teams/1338338/members$": [{'events_url': 'https://api.github.com/users/Mariocj89/events{/privacy}', 'following_url': 'https://api.github.com/users/Mariocj89/following{/other_user}', 'url': 'https://api.github.com/users/Mariocj89', 'starred_url': 'https://api.github.com/users/Mariocj89/starred{/owner}{/repo}', 'id': 3709683, 'login': 'Mariocj89', 'repos_url': 'https://api.github.com/users/Mariocj89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/3709683?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/Mariocj89/subscriptions', 'received_events_url': 'https://api.github.com/users/Mariocj89/received_events', 'gists_url': 'https://api.github.com/users/Mariocj89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/Mariocj89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/Mariocj89/followers', 'html_url': 'https://github.com/Mariocj89'}, {'events_url': 'https://api.github.com/users/palvarez89/events{/privacy}', 'following_url': 'https://api.github.com/users/palvarez89/following{/other_user}', 'url': 'https://api.github.com/users/palvarez89', 'starred_url': 'https://api.github.com/users/palvarez89/starred{/owner}{/repo}', 'id': 1928801, 'login': 'palvarez89', 'repos_url': 'https://api.github.com/users/palvarez89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/1928801?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/palvarez89/subscriptions', 'received_events_url': 'https://api.github.com/users/palvarez89/received_events', 'gists_url': 'https://api.github.com/users/palvarez89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/palvarez89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/palvarez89/followers', 'html_url': 'https://github.com/palvarez89'}],
    ".*/teams/1338338/memberships/Mariocj89$": {'url': 'https://api.github.com/teams/1338338/memberships/Mariocj89', 'role': 'member', 'state': 'active'},
    ".*/teams/1338338/memberships/palvarez89$": {'url': 'https://api.github.com/teams/1338338/memberships/palvarez89', 'role': 'member', 'state': 'active'},
    ".*/teams/1338338/repos$": [{'git_commits_url': 'https://api.github.com/repos/etcaterva/deployment/git/commits{/sha}', 'forks': 2, 'forks_url': 'https://api.github.com/repos/etcaterva/deployment/forks', 'has_pages': False, 'fork': False, 'has_downloads': True, 'hooks_url': 'https://api.github.com/repos/etcaterva/deployment/hooks', 'teams_url': 'https://api.github.com/repos/etcaterva/deployment/teams', 'has_wiki': True, 'has_issues': True, 'collaborators_url': 'https://api.github.com/repos/etcaterva/deployment/collaborators{/collaborator}', 'deployments_url': 'https://api.github.com/repos/etcaterva/deployment/deployments', 'labels_url': 'https://api.github.com/repos/etcaterva/deployment/labels{/name}', 'downloads_url': 'https://api.github.com/repos/etcaterva/deployment/downloads', 'issues_url': 'https://api.github.com/repos/etcaterva/deployment/issues{/number}', 'contributors_url': 'https://api.github.com/repos/etcaterva/deployment/contributors', 'mirror_url': None, 'watchers_count': 1, 'full_name': 'etcaterva/deployment', 'open_issues': 2, 'compare_url': 'https://api.github.com/repos/etcaterva/deployment/compare/{base}...{head}', 'statuses_url': 'https://api.github.com/repos/etcaterva/deployment/statuses/{sha}', 'default_branch': 'master', 'id': 31833637, 'languages_url': 'https://api.github.com/repos/etcaterva/deployment/languages', 'permissions': {'pull': True, 'admin': False, 'push': True}, 'trees_url': 'https://api.github.com/repos/etcaterva/deployment/git/trees{/sha}', 'stargazers_count': 1, 'events_url': 'https://api.github.com/repos/etcaterva/deployment/events', 'comments_url': 'https://api.github.com/repos/etcaterva/deployment/comments{/number}', 'tags_url': 'https://api.github.com/repos/etcaterva/deployment/tags', 'homepage': '', 'notifications_url': 'https://api.github.com/repos/etcaterva/deployment/notifications{?since,all,participating}', 'pulls_url': 'https://api.github.com/repos/etcaterva/deployment/pulls{/number}', 'owner': {'events_url': 'https://api.github.com/users/etcaterva/events{/privacy}', 'following_url': 'https://api.github.com/users/etcaterva/following{/other_user}', 'url': 'https://api.github.com/users/etcaterva', 'starred_url': 'https://api.github.com/users/etcaterva/starred{/owner}{/repo}', 'id': 11301498, 'login': 'etcaterva', 'repos_url': 'https://api.github.com/users/etcaterva/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/etcaterva/subscriptions', 'received_events_url': 'https://api.github.com/users/etcaterva/received_events', 'gists_url': 'https://api.github.com/users/etcaterva/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/etcaterva/orgs', 'type': 'Organization', 'followers_url': 'https://api.github.com/users/etcaterva/followers', 'html_url': 'https://github.com/etcaterva'}, 'forks_count': 2, 'updated_at': '2016-11-17T01:40:58Z', 'pushed_at': '2016-12-15T01:04:07Z', 'assignees_url': 'https://api.github.com/repos/etcaterva/deployment/assignees{/user}', 'url': 'https://api.github.com/repos/etcaterva/deployment', 'blobs_url': 'https://api.github.com/repos/etcaterva/deployment/git/blobs{/sha}', 'subscription_url': 'https://api.github.com/repos/etcaterva/deployment/subscription', 'private': False, 'issue_events_url': 'https://api.github.com/repos/etcaterva/deployment/issues/events{/number}', 'archive_url': 'https://api.github.com/repos/etcaterva/deployment/{archive_format}{/ref}', 'clone_url': 'https://github.com/etcaterva/deployment.git', 'releases_url': 'https://api.github.com/repos/etcaterva/deployment/releases{/id}', 'git_tags_url': 'https://api.github.com/repos/etcaterva/deployment/git/tags{/sha}', 'git_url': 'git://github.com/etcaterva/deployment.git', 'branches_url': 'https://api.github.com/repos/etcaterva/deployment/branches{/branch}', 'description': 'Ansible scripts to setup and configure EtCaterva servers', 'open_issues_count': 2, 'svn_url': 'https://github.com/etcaterva/deployment', 'html_url': 'https://github.com/etcaterva/deployment', 'contents_url': 'https://api.github.com/repos/etcaterva/deployment/contents/{+path}', 'watchers': 1, 'milestones_url': 'https://api.github.com/repos/etcaterva/deployment/milestones{/number}', 'stargazers_url': 'https://api.github.com/repos/etcaterva/deployment/stargazers', 'ssh_url': 'git@github.com:etcaterva/deployment.git', 'name': 'deployment', 'git_refs_url': 'https://api.github.com/repos/etcaterva/deployment/git/refs{/sha}', 'created_at': '2015-03-08T00:55:03Z', 'commits_url': 'https://api.github.com/repos/etcaterva/deployment/commits{/sha}', 'issue_comment_url': 'https://api.github.com/repos/etcaterva/deployment/issues/comments{/number}', 'size': 136, 'language': 'Python', 'keys_url': 'https://api.github.com/repos/etcaterva/deployment/keys{/key_id}', 'merges_url': 'https://api.github.com/repos/etcaterva/deployment/merges', 'subscribers_url': 'https://api.github.com/repos/etcaterva/deployment/subscribers'}],
    ".*/teams/1827619/members$": [{'events_url': 'https://api.github.com/users/Mariocj89/events{/privacy}', 'following_url': 'https://api.github.com/users/Mariocj89/following{/other_user}', 'url': 'https://api.github.com/users/Mariocj89', 'starred_url': 'https://api.github.com/users/Mariocj89/starred{/owner}{/repo}', 'id': 3709683, 'login': 'Mariocj89', 'repos_url': 'https://api.github.com/users/Mariocj89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/3709683?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/Mariocj89/subscriptions', 'received_events_url': 'https://api.github.com/users/Mariocj89/received_events', 'gists_url': 'https://api.github.com/users/Mariocj89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/Mariocj89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/Mariocj89/followers', 'html_url': 'https://github.com/Mariocj89'}],
    ".*/teams/1827619/memberships/Mariocj89$": {'url': 'https://api.github.com/teams/1827619/memberships/Mariocj89', 'role': 'member', 'state': 'active'},
    ".*/teams/1827619/repos$": [{'git_commits_url': 'https://api.github.com/repos/etcaterva/deployment/git/commits{/sha}', 'forks': 2, 'forks_url': 'https://api.github.com/repos/etcaterva/deployment/forks', 'has_pages': False, 'fork': False, 'has_downloads': True, 'hooks_url': 'https://api.github.com/repos/etcaterva/deployment/hooks', 'teams_url': 'https://api.github.com/repos/etcaterva/deployment/teams', 'has_wiki': True, 'has_issues': True, 'collaborators_url': 'https://api.github.com/repos/etcaterva/deployment/collaborators{/collaborator}', 'deployments_url': 'https://api.github.com/repos/etcaterva/deployment/deployments', 'labels_url': 'https://api.github.com/repos/etcaterva/deployment/labels{/name}', 'downloads_url': 'https://api.github.com/repos/etcaterva/deployment/downloads', 'issues_url': 'https://api.github.com/repos/etcaterva/deployment/issues{/number}', 'contributors_url': 'https://api.github.com/repos/etcaterva/deployment/contributors', 'mirror_url': None, 'watchers_count': 1, 'full_name': 'etcaterva/deployment', 'open_issues': 2, 'compare_url': 'https://api.github.com/repos/etcaterva/deployment/compare/{base}...{head}', 'statuses_url': 'https://api.github.com/repos/etcaterva/deployment/statuses/{sha}', 'default_branch': 'master', 'id': 31833637, 'languages_url': 'https://api.github.com/repos/etcaterva/deployment/languages', 'permissions': {'pull': True, 'admin': False, 'push': False}, 'trees_url': 'https://api.github.com/repos/etcaterva/deployment/git/trees{/sha}', 'stargazers_count': 1, 'events_url': 'https://api.github.com/repos/etcaterva/deployment/events', 'comments_url': 'https://api.github.com/repos/etcaterva/deployment/comments{/number}', 'tags_url': 'https://api.github.com/repos/etcaterva/deployment/tags', 'homepage': '', 'notifications_url': 'https://api.github.com/repos/etcaterva/deployment/notifications{?since,all,participating}', 'pulls_url': 'https://api.github.com/repos/etcaterva/deployment/pulls{/number}', 'owner': {'events_url': 'https://api.github.com/users/etcaterva/events{/privacy}', 'following_url': 'https://api.github.com/users/etcaterva/following{/other_user}', 'url': 'https://api.github.com/users/etcaterva', 'starred_url': 'https://api.github.com/users/etcaterva/starred{/owner}{/repo}', 'id': 11301498, 'login': 'etcaterva', 'repos_url': 'https://api.github.com/users/etcaterva/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/etcaterva/subscriptions', 'received_events_url': 'https://api.github.com/users/etcaterva/received_events', 'gists_url': 'https://api.github.com/users/etcaterva/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/etcaterva/orgs', 'type': 'Organization', 'followers_url': 'https://api.github.com/users/etcaterva/followers', 'html_url': 'https://github.com/etcaterva'}, 'forks_count': 2, 'updated_at': '2016-11-17T01:40:58Z', 'pushed_at': '2016-12-15T01:04:07Z', 'assignees_url': 'https://api.github.com/repos/etcaterva/deployment/assignees{/user}', 'url': 'https://api.github.com/repos/etcaterva/deployment', 'blobs_url': 'https://api.github.com/repos/etcaterva/deployment/git/blobs{/sha}', 'subscription_url': 'https://api.github.com/repos/etcaterva/deployment/subscription', 'private': False, 'issue_events_url': 'https://api.github.com/repos/etcaterva/deployment/issues/events{/number}', 'archive_url': 'https://api.github.com/repos/etcaterva/deployment/{archive_format}{/ref}', 'clone_url': 'https://github.com/etcaterva/deployment.git', 'releases_url': 'https://api.github.com/repos/etcaterva/deployment/releases{/id}', 'git_tags_url': 'https://api.github.com/repos/etcaterva/deployment/git/tags{/sha}', 'git_url': 'git://github.com/etcaterva/deployment.git', 'branches_url': 'https://api.github.com/repos/etcaterva/deployment/branches{/branch}', 'description': 'Ansible scripts to setup and configure EtCaterva servers', 'open_issues_count': 2, 'svn_url': 'https://github.com/etcaterva/deployment', 'html_url': 'https://github.com/etcaterva/deployment', 'contents_url': 'https://api.github.com/repos/etcaterva/deployment/contents/{+path}', 'watchers': 1, 'milestones_url': 'https://api.github.com/repos/etcaterva/deployment/milestones{/number}', 'stargazers_url': 'https://api.github.com/repos/etcaterva/deployment/stargazers', 'ssh_url': 'git@github.com:etcaterva/deployment.git', 'name': 'deployment', 'git_refs_url': 'https://api.github.com/repos/etcaterva/deployment/git/refs{/sha}', 'created_at': '2015-03-08T00:55:03Z', 'commits_url': 'https://api.github.com/repos/etcaterva/deployment/commits{/sha}', 'issue_comment_url': 'https://api.github.com/repos/etcaterva/deployment/issues/comments{/number}', 'size': 136, 'language': 'Python', 'keys_url': 'https://api.github.com/repos/etcaterva/deployment/keys{/key_id}', 'merges_url': 'https://api.github.com/repos/etcaterva/deployment/merges', 'subscribers_url': 'https://api.github.com/repos/etcaterva/deployment/subscribers'}, {'git_commits_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/git/commits{/sha}', 'forks': 0, 'forks_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/forks', 'has_pages': False, 'fork': False, 'has_downloads': True, 'hooks_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/hooks', 'teams_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/teams', 'has_wiki': True, 'has_issues': True, 'collaborators_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/collaborators{/collaborator}', 'deployments_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/deployments', 'labels_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/labels{/name}', 'downloads_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/downloads', 'issues_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/issues{/number}', 'contributors_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/contributors', 'mirror_url': None, 'watchers_count': 0, 'full_name': 'etcaterva/echaloasuerte-mobile', 'open_issues': 0, 'compare_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/compare/{base}...{head}', 'statuses_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/statuses/{sha}', 'default_branch': 'master', 'id': 58308545, 'languages_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/languages', 'permissions': {'pull': True, 'admin': False, 'push': False}, 'trees_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/git/trees{/sha}', 'stargazers_count': 0, 'events_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/events', 'comments_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/comments{/number}', 'tags_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/tags', 'homepage': 'https://build.phonegap.com/apps/2061794', 'notifications_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/notifications{?since,all,participating}', 'pulls_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/pulls{/number}', 'owner': {'events_url': 'https://api.github.com/users/etcaterva/events{/privacy}', 'following_url': 'https://api.github.com/users/etcaterva/following{/other_user}', 'url': 'https://api.github.com/users/etcaterva', 'starred_url': 'https://api.github.com/users/etcaterva/starred{/owner}{/repo}', 'id': 11301498, 'login': 'etcaterva', 'repos_url': 'https://api.github.com/users/etcaterva/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/etcaterva/subscriptions', 'received_events_url': 'https://api.github.com/users/etcaterva/received_events', 'gists_url': 'https://api.github.com/users/etcaterva/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/etcaterva/orgs', 'type': 'Organization', 'followers_url': 'https://api.github.com/users/etcaterva/followers', 'html_url': 'https://github.com/etcaterva'}, 'forks_count': 0, 'updated_at': '2016-05-11T18:36:57Z', 'pushed_at': '2016-05-13T20:01:38Z', 'assignees_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/assignees{/user}', 'url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile', 'blobs_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/git/blobs{/sha}', 'subscription_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/subscription', 'private': False, 'issue_events_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/issues/events{/number}', 'archive_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/{archive_format}{/ref}', 'clone_url': 'https://github.com/etcaterva/echaloasuerte-mobile.git', 'releases_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/releases{/id}', 'git_tags_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/git/tags{/sha}', 'git_url': 'git://github.com/etcaterva/echaloasuerte-mobile.git', 'branches_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/branches{/branch}', 'description': 'phonehap app for multiple platforms', 'open_issues_count': 0, 'svn_url': 'https://github.com/etcaterva/echaloasuerte-mobile', 'html_url': 'https://github.com/etcaterva/echaloasuerte-mobile', 'contents_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/contents/{+path}', 'watchers': 0, 'milestones_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/milestones{/number}', 'stargazers_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/stargazers', 'ssh_url': 'git@github.com:etcaterva/echaloasuerte-mobile.git', 'name': 'echaloasuerte-mobile', 'git_refs_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/git/refs{/sha}', 'created_at': '2016-05-08T11:13:37Z', 'commits_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/commits{/sha}', 'issue_comment_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/issues/comments{/number}', 'size': 5487, 'language': 'JavaScript', 'keys_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/keys{/key_id}', 'merges_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/merges', 'subscribers_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-mobile/subscribers'}],
    ".*/teams/1827620/members$": [{'events_url': 'https://api.github.com/users/dnaranjo89/events{/privacy}', 'following_url': 'https://api.github.com/users/dnaranjo89/following{/other_user}', 'url': 'https://api.github.com/users/dnaranjo89', 'starred_url': 'https://api.github.com/users/dnaranjo89/starred{/owner}{/repo}', 'id': 9324508, 'login': 'dnaranjo89', 'repos_url': 'https://api.github.com/users/dnaranjo89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/9324508?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/dnaranjo89/subscriptions', 'received_events_url': 'https://api.github.com/users/dnaranjo89/received_events', 'gists_url': 'https://api.github.com/users/dnaranjo89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/dnaranjo89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/dnaranjo89/followers', 'html_url': 'https://github.com/dnaranjo89'}, {'events_url': 'https://api.github.com/users/Mariocj89/events{/privacy}', 'following_url': 'https://api.github.com/users/Mariocj89/following{/other_user}', 'url': 'https://api.github.com/users/Mariocj89', 'starred_url': 'https://api.github.com/users/Mariocj89/starred{/owner}{/repo}', 'id': 3709683, 'login': 'Mariocj89', 'repos_url': 'https://api.github.com/users/Mariocj89/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/3709683?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/Mariocj89/subscriptions', 'received_events_url': 'https://api.github.com/users/Mariocj89/received_events', 'gists_url': 'https://api.github.com/users/Mariocj89/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/Mariocj89/orgs', 'type': 'User', 'followers_url': 'https://api.github.com/users/Mariocj89/followers', 'html_url': 'https://github.com/Mariocj89'}],
    ".*/teams/1827620/memberships/dnaranjo89$": {'url': 'https://api.github.com/teams/1827620/memberships/dnaranjo89', 'role': 'member', 'state': 'active'},
    ".*/teams/1827620/memberships/Mariocj89$": {'url': 'https://api.github.com/teams/1827620/memberships/Mariocj89', 'role': 'member', 'state': 'active'},
    ".*/teams/1827620/repos$": [{'git_commits_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/git/commits{/sha}', 'forks': 4, 'forks_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/forks', 'has_pages': False, 'fork': False, 'has_downloads': True, 'hooks_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/hooks', 'teams_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/teams', 'has_wiki': False, 'has_issues': True, 'collaborators_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/collaborators{/collaborator}', 'deployments_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/deployments', 'labels_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/labels{/name}', 'downloads_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/downloads', 'issues_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/issues{/number}', 'contributors_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/contributors', 'mirror_url': None, 'watchers_count': 4, 'full_name': 'etcaterva/echaloasuerte', 'open_issues': 5, 'compare_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/compare/{base}...{head}', 'statuses_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/statuses/{sha}', 'default_branch': 'master', 'id': 23440601, 'languages_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/languages', 'permissions': {'pull': True, 'admin': False, 'push': True}, 'trees_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/git/trees{/sha}', 'stargazers_count': 4, 'events_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/events', 'comments_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/comments{/number}', 'tags_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/tags', 'homepage': 'https://echaloasuerte.com', 'notifications_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/notifications{?since,all,participating}', 'pulls_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/pulls{/number}', 'owner': {'events_url': 'https://api.github.com/users/etcaterva/events{/privacy}', 'following_url': 'https://api.github.com/users/etcaterva/following{/other_user}', 'url': 'https://api.github.com/users/etcaterva', 'starred_url': 'https://api.github.com/users/etcaterva/starred{/owner}{/repo}', 'id': 11301498, 'login': 'etcaterva', 'repos_url': 'https://api.github.com/users/etcaterva/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/etcaterva/subscriptions', 'received_events_url': 'https://api.github.com/users/etcaterva/received_events', 'gists_url': 'https://api.github.com/users/etcaterva/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/etcaterva/orgs', 'type': 'Organization', 'followers_url': 'https://api.github.com/users/etcaterva/followers', 'html_url': 'https://github.com/etcaterva'}, 'forks_count': 4, 'updated_at': '2016-11-18T00:32:35Z', 'pushed_at': '2016-11-18T00:32:34Z', 'assignees_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/assignees{/user}', 'url': 'https://api.github.com/repos/etcaterva/echaloasuerte', 'blobs_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/git/blobs{/sha}', 'subscription_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/subscription', 'private': False, 'issue_events_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/issues/events{/number}', 'archive_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/{archive_format}{/ref}', 'clone_url': 'https://github.com/etcaterva/echaloasuerte.git', 'releases_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/releases{/id}', 'git_tags_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/git/tags{/sha}', 'git_url': 'git://github.com/etcaterva/echaloasuerte.git', 'branches_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/branches{/branch}', 'description': None, 'open_issues_count': 5, 'svn_url': 'https://github.com/etcaterva/echaloasuerte', 'html_url': 'https://github.com/etcaterva/echaloasuerte', 'contents_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/contents/{+path}', 'watchers': 4, 'milestones_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/milestones{/number}', 'stargazers_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/stargazers', 'ssh_url': 'git@github.com:etcaterva/echaloasuerte.git', 'name': 'echaloasuerte', 'git_refs_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/git/refs{/sha}', 'created_at': '2014-08-28T19:40:10Z', 'commits_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/commits{/sha}', 'issue_comment_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/issues/comments{/number}', 'size': 7365, 'language': 'Python', 'keys_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/keys{/key_id}', 'merges_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/merges', 'subscribers_url': 'https://api.github.com/repos/etcaterva/echaloasuerte/subscribers'}, {'git_commits_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/git/commits{/sha}', 'forks': 0, 'forks_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/forks', 'has_pages': False, 'fork': False, 'has_downloads': True, 'hooks_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/hooks', 'teams_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/teams', 'has_wiki': True, 'has_issues': True, 'collaborators_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/collaborators{/collaborator}', 'deployments_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/deployments', 'labels_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/labels{/name}', 'downloads_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/downloads', 'issues_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/issues{/number}', 'contributors_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/contributors', 'mirror_url': None, 'watchers_count': 0, 'full_name': 'etcaterva/echaloasuerte-legacy', 'open_issues': 0, 'compare_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/compare/{base}...{head}', 'statuses_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/statuses/{sha}', 'default_branch': 'master', 'id': 34215578, 'languages_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/languages', 'permissions': {'pull': True, 'admin': False, 'push': True}, 'trees_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/git/trees{/sha}', 'stargazers_count': 0, 'events_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/events', 'comments_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/comments{/number}', 'tags_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/tags', 'homepage': None, 'notifications_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/notifications{?since,all,participating}', 'pulls_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/pulls{/number}', 'owner': {'events_url': 'https://api.github.com/users/etcaterva/events{/privacy}', 'following_url': 'https://api.github.com/users/etcaterva/following{/other_user}', 'url': 'https://api.github.com/users/etcaterva', 'starred_url': 'https://api.github.com/users/etcaterva/starred{/owner}{/repo}', 'id': 11301498, 'login': 'etcaterva', 'repos_url': 'https://api.github.com/users/etcaterva/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/etcaterva/subscriptions', 'received_events_url': 'https://api.github.com/users/etcaterva/received_events', 'gists_url': 'https://api.github.com/users/etcaterva/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/etcaterva/orgs', 'type': 'Organization', 'followers_url': 'https://api.github.com/users/etcaterva/followers', 'html_url': 'https://github.com/etcaterva'}, 'forks_count': 0, 'updated_at': '2016-05-11T18:35:07Z', 'pushed_at': '2015-07-15T22:58:54Z', 'assignees_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/assignees{/user}', 'url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy', 'blobs_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/git/blobs{/sha}', 'subscription_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/subscription', 'private': False, 'issue_events_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/issues/events{/number}', 'archive_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/{archive_format}{/ref}', 'clone_url': 'https://github.com/etcaterva/echaloasuerte-legacy.git', 'releases_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/releases{/id}', 'git_tags_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/git/tags{/sha}', 'git_url': 'git://github.com/etcaterva/echaloasuerte-legacy.git', 'branches_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/branches{/branch}', 'description': 'Previous versions of echaloasuerte', 'open_issues_count': 0, 'svn_url': 'https://github.com/etcaterva/echaloasuerte-legacy', 'html_url': 'https://github.com/etcaterva/echaloasuerte-legacy', 'contents_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/contents/{+path}', 'watchers': 0, 'milestones_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/milestones{/number}', 'stargazers_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/stargazers', 'ssh_url': 'git@github.com:etcaterva/echaloasuerte-legacy.git', 'name': 'echaloasuerte-legacy', 'git_refs_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/git/refs{/sha}', 'created_at': '2015-04-19T17:01:59Z', 'commits_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/commits{/sha}', 'issue_comment_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/issues/comments{/number}', 'size': 1608, 'language': 'PHP', 'keys_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/keys{/key_id}', 'merges_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/merges', 'subscribers_url': 'https://api.github.com/repos/etcaterva/echaloasuerte-legacy/subscribers'}, {'git_commits_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/git/commits{/sha}', 'forks': 0, 'forks_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/forks', 'has_pages': False, 'fork': False, 'has_downloads': True, 'hooks_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/hooks', 'teams_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/teams', 'has_wiki': True, 'has_issues': True, 'collaborators_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/collaborators{/collaborator}', 'deployments_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/deployments', 'labels_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/labels{/name}', 'downloads_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/downloads', 'issues_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/issues{/number}', 'contributors_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/contributors', 'mirror_url': None, 'watchers_count': 0, 'full_name': 'etcaterva/etcaterva-web', 'open_issues': 1, 'compare_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/compare/{base}...{head}', 'statuses_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/statuses/{sha}', 'default_branch': 'master', 'id': 8443788, 'languages_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/languages', 'permissions': {'pull': True, 'admin': False, 'push': True}, 'trees_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/git/trees{/sha}', 'stargazers_count': 0, 'events_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/events', 'comments_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/comments{/number}', 'tags_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/tags', 'homepage': 'https://etcaterva.com', 'notifications_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/notifications{?since,all,participating}', 'pulls_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/pulls{/number}', 'owner': {'events_url': 'https://api.github.com/users/etcaterva/events{/privacy}', 'following_url': 'https://api.github.com/users/etcaterva/following{/other_user}', 'url': 'https://api.github.com/users/etcaterva', 'starred_url': 'https://api.github.com/users/etcaterva/starred{/owner}{/repo}', 'id': 11301498, 'login': 'etcaterva', 'repos_url': 'https://api.github.com/users/etcaterva/repos', 'avatar_url': 'https://avatars.githubusercontent.com/u/11301498?v=3', 'gravatar_id': '', 'subscriptions_url': 'https://api.github.com/users/etcaterva/subscriptions', 'received_events_url': 'https://api.github.com/users/etcaterva/received_events', 'gists_url': 'https://api.github.com/users/etcaterva/gists{/gist_id}', 'site_admin': False, 'organizations_url': 'https://api.github.com/users/etcaterva/orgs', 'type': 'Organization', 'followers_url': 'https://api.github.com/users/etcaterva/followers', 'html_url': 'https://github.com/etcaterva'}, 'forks_count': 0, 'updated_at': '2016-09-18T20:39:26Z', 'pushed_at': '2014-11-11T21:58:21Z', 'assignees_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/assignees{/user}', 'url': 'https://api.github.com/repos/etcaterva/etcaterva-web', 'blobs_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/git/blobs{/sha}', 'subscription_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/subscription', 'private': False, 'issue_events_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/issues/events{/number}', 'archive_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/{archive_format}{/ref}', 'clone_url': 'https://github.com/etcaterva/etcaterva-web.git', 'releases_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/releases{/id}', 'git_tags_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/git/tags{/sha}', 'git_url': 'git://github.com/etcaterva/etcaterva-web.git', 'branches_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/branches{/branch}', 'description': 'Old web site of the group', 'open_issues_count': 1, 'svn_url': 'https://github.com/etcaterva/etcaterva-web', 'html_url': 'https://github.com/etcaterva/etcaterva-web', 'contents_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/contents/{+path}', 'watchers': 0, 'milestones_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/milestones{/number}', 'stargazers_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/stargazers', 'ssh_url': 'git@github.com:etcaterva/etcaterva-web.git', 'name': 'etcaterva-web', 'git_refs_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/git/refs{/sha}', 'created_at': '2013-02-26T22:44:38Z', 'commits_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/commits{/sha}', 'issue_comment_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/issues/comments{/number}', 'size': 2708, 'language': 'Python', 'keys_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/keys{/key_id}', 'merges_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/merges', 'subscribers_url': 'https://api.github.com/repos/etcaterva/etcaterva-web/subscribers'}],
    ".*/orgs/etcaterva/hooks$": [],
})

EXPECTED_RESULT = """hooks: {}
members:
  Mariocj89:
    role: admin
  dnaranjo89:
    role: admin
  palvarez89:
    role: admin
options:
  billing_email: mariocj89@gmail.com
  company: null
  description: Group of friends that code :)
  email: ''
  location: ''
  name: EtCaterva
teams:
  Automation:
    description: ''
    id: 1338338
    members:
      Mariocj89:
        role: member
      palvarez89:
        role: member
    permission: admin
    privacy: closed
    repositories:
      deployment:
        permission: push
  Mobile:
    description: Pepole working in the apps
    id: 1827619
    members:
      Mariocj89:
        role: member
    permission: pull
    privacy: closed
    repositories:
      deployment:
        permission: pull
      echaloasuerte-mobile:
        permission: pull
  Web:
    description: Web developers
    id: 1827620
    members:
      Mariocj89:
        role: member
      dnaranjo89:
        role: member
    permission: pull
    privacy: closed
    repositories:
      echaloasuerte:
        permission: push
      echaloasuerte-legacy:
        permission: push
      etcaterva-web:
        permission: push
"""


def get_mock_response(url):
    """Using the urls in GET_REQUESTS builds a mock and returns it"""
    res_payload = GET_REQUESTS[url]
    mock = sealedmock.SealedMock()
    mock.json.return_value = copy.deepcopy(res_payload)
    mock.raise_for_status = lambda: None
    mock.sealed = True
    return mock


@sealedmock.patch("dothub._main.github_helper.requests.Session")
def test_repo_serialization(session_mock):
    runner = CliRunner()
    session_mock.return_value.get.side_effect = get_mock_response
    session_mock.sealed = True
    with tempfile.NamedTemporaryFile() as file_:
        args = base_args + ["org", "--name=etcaterva", "pull",
                            "--output_file=" + file_.name]
        result = runner.invoke(dothub, args, obj={})

        assert 0 == result.exit_code
        with open(file_.name) as f:
            result_config = f.read()
        assert EXPECTED_RESULT == result_config


@sealedmock.patch("dothub._main.github_helper.requests.Session")
def test_org_push_without_changes(session_mock):
    runner = CliRunner()
    session_mock.return_value.get.side_effect = get_mock_response
    session_mock.sealed = True
    with tempfile.NamedTemporaryFile() as file_:
        with open(file_.name, 'w') as f:
            f.write(EXPECTED_RESULT)

        args = base_args + ["org", "--name=etcaterva", "push",
                            "--input_file=" + file_.name]
        result = runner.invoke(dothub, args, obj={})

        assert 0 == result.exit_code
        # session put/patch/delete were not called


@sealedmock.patch("dothub._main.github_helper.requests.Session")
def test_repo_push_with_changes(session_mock):
    runner = CliRunner()
    session_mock.return_value.get.side_effect = get_mock_response
    session_mock.return_value.post.return_value = Mock()
    session_mock.return_value.patch.return_value = Mock()
    session_mock.return_value.put.return_value = Mock()
    session_mock.return_value.delete.return_value = Mock()
    session_mock.sealed = True

    new_config = yaml.safe_load(EXPECTED_RESULT)
    # Remove a member
    member_config = new_config['members'].pop("palvarez89")
    # Add member
    new_config['members']["new_member"] = member_config
    # Updated member
    new_config['members']["Mariocj89"]["role"] = "member"

    new_config["options"]["company"] = "Bloomberg"

    team_config = new_config["teams"].pop("Automation")
    new_config["teams"]["new_team"] = team_config

    with tempfile.NamedTemporaryFile() as file_:
        with open(file_.name, 'w') as f:
            yaml.safe_dump(new_config, f, encoding='utf-8', allow_unicode=True,
                           default_flow_style=False)

        args = base_args + ["org", "--name=etcaterva", "push",
                            "--input_file=" + file_.name]
        result = runner.invoke(dothub, args, obj={})

    assert 0 == result.exit_code
    assert 1 == session_mock.return_value.post.call_count
    assert 5 == session_mock.return_value.put.call_count
    assert 2 == session_mock.return_value.delete.call_count
    assert 1 == session_mock.return_value.patch.call_count

